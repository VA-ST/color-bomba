(function(t){var i={init:function(){this.c=document.getElementById("game"),this.c.width=this.c.width,this.c.height=this.c.height,this.ctx=this.c.getContext("2d"),this.color="rgba(20,20,20,.7)",this.bullets=[],this.enemyBullets=[],this.enemies=[],this.particles=[],this.bulletIndex=0,this.enemyBulletIndex=0,this.enemyIndex=0,this.particleIndex=0,this.maxParticles=10,this.maxEnemies=6,this.enemiesAlive=0,this.currentFrame=0,this.maxLives=3,this.life=0,this.binding(),this.player=new e,this.score=0,this.paused=!1,this.shooting=!1,this.oneShot=!1,this.isGameOver=!1,this.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame;for(var i=0;i<this.maxEnemies;i++)new h,this.enemiesAlive++;this.invincibleMode(2e3),this.loop()},binding:function(){t.addEventListener("keydown",this.buttonDown),t.addEventListener("keyup",this.buttonUp),t.addEventListener("keypress",this.keyPressed),this.c.addEventListener("click",this.clicked)},clicked:function(){i.paused?i.isGameOver?i.init():(i.unPause(),i.loop(),i.invincibleMode(1e3)):i.pause()},keyPressed:function(t){32===t.keyCode&&(i.player.invincible||i.oneShot||(i.player.shoot(),i.oneShot=!0),i.isGameOver&&i.init(),t.preventDefault())},buttonUp:function(t){32===t.keyCode&&(i.shooting=!1,i.oneShot=!1,t.preventDefault()),37!==t.keyCode&&65!==t.keyCode||(i.player.movingLeft=!1),39!==t.keyCode&&68!==t.keyCode||(i.player.movingRight=!1)},buttonDown:function(t){32===t.keyCode&&(i.shooting=!0),37!==t.keyCode&&65!==t.keyCode||(i.player.movingLeft=!0),39!==t.keyCode&&68!==t.keyCode||(i.player.movingRight=!0)},random:function(t,i){return Math.floor(Math.random()*(i-t)+t)},invincibleMode:function(t){this.player.invincible=!0,setTimeout(function(){i.player.invincible=!1},t)},collision:function(t,i){return!(t.y+t.height<i.y||t.y>i.y+i.height||t.x+t.width<i.x||t.x>i.x+i.width)},clear:function(){this.ctx.fillStyle=i.color,this.ctx.fillRect(0,0,this.c.width,this.c.height)},pause:function(){this.paused=!0},unPause:function(){this.paused=!1},gameOver:function(){this.isGameOver=!0,this.clear();var t="Game Over",e="Score: "+i.score,s="Click or press Spacebar to Play Again";this.pause(),this.ctx.fillStyle="white",this.ctx.font="bold 30px Lato, sans-serif",this.ctx.fillText(t,this.c.width/2-this.ctx.measureText(t).width/2,this.c.height/2-50),this.ctx.fillText(e,this.c.width/2-this.ctx.measureText(e).width/2,this.c.height/2-5),this.ctx.font="bold 16px Lato, sans-serif",this.ctx.fillText(s,this.c.width/2-this.ctx.measureText(s).width/2,this.c.height/2+30)},updateScore:function(){this.ctx.fillStyle="white",this.ctx.font="16px Lato, sans-serif",this.ctx.fillText("Score: "+this.score,8,20),this.ctx.fillText("Lives: "+(this.maxLives-this.life),8,40)},loop:function(){if(!i.paused){for(var e in i.clear(),i.enemies){var s=i.enemies[e];s.draw(),s.update(),i.currentFrame%s.shootingSpeed==0&&s.shoot()}for(var h in i.enemyBullets)i.enemyBullets[h].draw(),i.enemyBullets[h].update();for(var n in i.bullets)i.bullets[n].draw(),i.bullets[n].update();for(var e in i.player.invincible?i.currentFrame%20==0&&i.player.draw():i.player.draw(),i.particles)i.particles[e].draw();i.player.update(),i.updateScore(),i.currentFrame=i.requestAnimationFrame.call(t,i.loop)}}},e=function(){this.width=60,this.height=20,this.x=i.c.width/2-this.width/2,this.y=i.c.height-this.height,this.movingLeft=!1,this.movingRight=!1,this.speed=8,this.invincible=!1,this.color="white"};e.prototype.die=function(){i.life<i.maxLives?(i.invincibleMode(2e3),i.life++):(i.pause(),i.gameOver())},e.prototype.draw=function(){i.ctx.fillStyle=this.color,i.ctx.fillRect(this.x,this.y,this.width,this.height)},e.prototype.update=function(){for(var t in this.movingLeft&&this.x>0&&(this.x-=this.speed),this.movingRight&&this.x+this.width<i.c.width&&(this.x+=this.speed),i.shooting&&i.currentFrame%10==0&&this.shoot(),i.enemyBullets){var e=i.enemyBullets[t];i.collision(e,this)&&!i.player.invincible&&(this.die(),delete i.enemyBullets[t])}},e.prototype.shoot=function(){i.bullets[i.bulletIndex]=new s(this.x+this.width/2),i.bulletIndex++};var s=function(t){this.width=8,this.height=20,this.x=t,this.y=i.c.height-10,this.vy=8,this.index=i.bulletIndex,this.active=!0,this.color="white"};s.prototype.draw=function(){i.ctx.fillStyle=this.color,i.ctx.fillRect(this.x,this.y,this.width,this.height)},s.prototype.update=function(){this.y-=this.vy,this.y<0&&delete i.bullets[this.index]};var h=function(){this.width=60,this.height=20,this.x=i.random(0,i.c.width-this.width),this.y=i.random(10,40),this.vy=.1*i.random(1,3),this.index=i.enemyIndex,i.enemies[i.enemyIndex]=this,i.enemyIndex++,this.speed=i.random(2,3),this.shootingSpeed=i.random(30,80),this.movingLeft=Math.random()<.5,this.color="hsl("+i.random(0,360)+", 60%, 50%)"};h.prototype.draw=function(){i.ctx.fillStyle=this.color,i.ctx.fillRect(this.x,this.y,this.width,this.height)},h.prototype.update=function(){for(var t in this.movingLeft?this.x>0?(this.x-=this.speed,this.y+=this.vy):this.movingLeft=!1:this.x+this.width<i.c.width?(this.x+=this.speed,this.y+=this.vy):this.movingLeft=!0,i.bullets){var e=i.bullets[t];i.collision(e,this)&&(this.die(),delete i.bullets[t])}},h.prototype.die=function(){this.explode(),delete i.enemies[this.index],i.score+=15,i.enemiesAlive=i.enemiesAlive>1?i.enemiesAlive-1:0,i.enemiesAlive<i.maxEnemies&&(i.enemiesAlive++,setTimeout(function(){new h},2e3))},h.prototype.explode=function(){for(var t=0;t<i.maxParticles;t++)new o(this.x+this.width/2,this.y,this.color)},h.prototype.shoot=function(){new n(this.x+this.width/2,this.y,this.color)};var n=function(t,e,s){this.width=8,this.height=20,this.x=t,this.y=e,this.vy=6,this.color=s,this.index=i.enemyBulletIndex,i.enemyBullets[i.enemyBulletIndex]=this,i.enemyBulletIndex++};n.prototype.draw=function(){i.ctx.fillStyle=this.color,i.ctx.fillRect(this.x,this.y,this.width,this.height)},n.prototype.update=function(){this.y+=this.vy,this.y>i.c.height&&delete i.enemyBullets[this.index]};var o=function(t,e,s){this.x=t,this.y=e,this.vx=i.random(-5,5),this.vy=i.random(-5,5),this.color=s||"orange",i.particles[i.particleIndex]=this,this.id=i.particleIndex,i.particleIndex++,this.life=0,this.gravity=.05,this.size=40,this.maxlife=100};o.prototype.draw=function(){this.x+=this.vx,this.y+=this.vy,this.vy+=this.gravity,this.size*=.89,i.ctx.fillStyle=this.color,i.ctx.fillRect(this.x,this.y,this.size,this.size),this.life++,this.life>=this.maxlife&&delete i.particles[this.id]},i.init()})(window);